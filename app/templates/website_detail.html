{% extends "base.html" %}

{% block title %}Website Details - Uptime Monitor{% endblock %}

{% block extra_css %}
<style>
    .chart-container {
        position: relative;
        height: 400px;
        margin-bottom: 2rem;
    }
</style>
{% endblock %}

{% block content %}
<div class="container-lg">
    <div class="mb-4">
        <div class="d-flex justify-content-between align-items-center">
            <h1>{{ website.url }}</h1>
            <div>
                <span class="status-badge status-{{ website.last_status.value|lower if website.last_status else 'unknown' }}">
                    {{ website.last_status.value or 'UNKNOWN' }}
                </span>
            </div>
        </div>
        <small class="text-muted">Added on {{ website.created_at|string }}</small>
    </div>

    <div class="row mb-4">
        <div class="col-md-3 mb-3">
            <div class="card metric-card">
                <h3>Current Status</h3>
                <div class="metric-value" style="color: {% if website.last_status.value == 'UP' %}#28a745{% else %}#dc3545{% endif %};">
                    {{ website.last_status.value or 'N/A' }}
                </div>
            </div>
        </div>
        <div class="col-md-3 mb-3">
            <div class="card metric-card">
                <h3>Uptime</h3>
                <div class="metric-value">{{ uptime_percentage|round(2) }}%</div>
            </div>
        </div>
        <div class="col-md-3 mb-3">
            <div class="card metric-card">
                <h3>Avg Response Time</h3>
                <div class="metric-value">{{ avg_response_time|round(2) }}ms</div>
            </div>
        </div>
        <div class="col-md-3 mb-3">
            <div class="card metric-card">
                <h3>Total Incidents</h3>
                <div class="metric-value">{{ incidents_count }}</div>
            </div>
        </div>
    </div>

    <div class="row mb-4">
        <div class="col-lg-12">
            <div class="card">
                <div class="card-header bg-light">
                    <h5 class="mb-0">Response Time Trend (Last 24 Hours)</h5>
                </div>
                <div class="card-body">
                    <div class="chart-container">
                        <canvas id="responseTimeChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row mb-4">
        <div class="col-lg-8">
            <div class="card">
                <div class="card-header bg-light">
                    <h5 class="mb-0">Recent Checks</h5>
                </div>
                <div class="table-responsive">
                    <table class="table table-sm mb-0">
                        <thead>
                            <tr>
                                <th>Time</th>
                                <th>Status</th>
                                <th>Response Time</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% if recent_checks %}
                                {% for check in recent_checks %}
                                    <tr>
                                        <td>{{ check.checked_at|string }}</td>
                                        <td>
                                            <span class="status-badge status-{{ check.status.value|lower }}">
                                                {{ check.status.value }}
                                            </span>
                                        </td>
                                        <td>
                                            {% if check.response_time_ms %}
                                                {{ check.response_time_ms|round(2) }}ms
                                            {% else %}
                                                N/A
                                            {% endif %}
                                        </td>
                                    </tr>
                                {% endfor %}
                            {% else %}
                                <tr>
                                    <td colspan="3" class="text-center text-muted">No checks yet</td>
                                </tr>
                            {% endif %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        <div class="col-lg-4">
            <div class="card">
                <div class="card-header bg-light">
                    <h5 class="mb-0">Website Info</h5>
                </div>
                <div class="card-body">
                    <p><strong>URL:</strong> <code>{{ website.url }}</code></p>
                    <p><strong>Check Interval:</strong> {{ website.check_interval }} seconds</p>
                    <p><strong>Status:</strong> 
                        {% if website.is_active %}
                            <span class="badge bg-success">Active</span>
                        {% else %}
                            <span class="badge bg-secondary">Inactive</span>
                        {% endif %}
                    </p>
                    <p><strong>Last Checked:</strong> 
                        {% if website.last_checked_at %}
                            {{ website.last_checked_at|string }}
                        {% else %}
                            Never
                        {% endif %}
                    </p>
                </div>
                <div class="card-footer bg-light">
                    <a href="/website/{{ website.id }}/edit" class="btn btn-sm btn-primary w-100">Edit Website</a>
                </div>
            </div>
        </div>
    </div>

    {% if incidents %}
        <div class="row">
            <div class="col-lg-12">
                <div class="card">
                    <div class="card-header bg-light">
                        <h5 class="mb-0">Recent Incidents</h5>
                    </div>
                    <div class="table-responsive">
                        <table class="table table-sm mb-0">
                            <thead>
                                <tr>
                                    <th>Start Time</th>
                                    <th>End Time</th>
                                    <th>Duration</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for incident in incidents %}
                                    <tr>
                                        <td>{{ incident.started_at|string }}</td>
                                        <td>
                                            {% if incident.resolved_at %}
                                                {{ incident.resolved_at|string }}
                                            {% else %}
                                                <span class="badge bg-danger">Ongoing</span>
                                            {% endif %}
                                        </td>
                                        <td>
                                            {% if incident.resolved_at %}
                                                {{ incident.duration }}
                                            {% else %}
                                                Ongoing
                                            {% endif %}
                                        </td>
                                        <td>
                                            {% if incident.resolved_at %}
                                                <span class="badge bg-success">Resolved</span>
                                            {% else %}
                                                <span class="badge bg-danger">Active</span>
                                            {% endif %}
                                        </td>
                                    </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    {% endif %}

    <div class="mt-4 mb-2">
        <a href="/dashboard" class="btn btn-secondary">Back to Dashboard</a>
    </div>
</div>

{% endblock %}

{% block extra_js %}
<script>
    // Sample data - replace with actual data
    const responseTimeData = {
        labels: {{ labels|safe }},
        data: {{ response_times|safe }}
    };

    createResponseTimeChart('responseTimeChart', responseTimeData.labels, responseTimeData.data);
</script>
{% endblock %}
